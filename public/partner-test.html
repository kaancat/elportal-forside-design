<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DinElportal Partner Integration Test</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #1f2937;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 32px;
            color: #1f2937;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #6b7280;
            font-size: 18px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .card h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .step-number {
            background: #6366f1;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
        }
        
        .info-box {
            background: #eff6ff;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .info-box h3 {
            color: #1e40af;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        
        .info-box p {
            color: #1e40af;
            font-size: 14px;
            margin: 0;
        }
        
        .warning-box {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .warning-box p {
            color: #92400e;
            font-size: 14px;
            margin: 0;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-item {
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 4px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        
        .status-item.checking {
            border-left-color: #3b82f6;
            background: #eff6ff;
            animation: pulse 2s infinite;
        }
        
        .status-item.success {
            border-left-color: #10b981;
            background: #d1fae5;
        }
        
        .status-item.error {
            border-left-color: #ef4444;
            background: #fee2e2;
        }
        
        .status-item.warning {
            border-left-color: #f59e0b;
            background: #fef3c7;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .status-label {
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .status-value {
            font-size: 14px;
            font-weight: 600;
            color: #1f2937;
            word-break: break-all;
        }
        
        .status-icon {
            font-size: 20px;
            margin-right: 5px;
        }
        
        .input-group {
            margin: 20px 0;
        }
        
        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #6366f1;
        }
        
        .button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .button:hover {
            background: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.3);
        }
        
        .button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        
        .button.secondary {
            background: #6b7280;
        }
        
        .button.secondary:hover {
            background: #4b5563;
        }
        
        .button.success {
            background: #10b981;
        }
        
        .button.success:hover {
            background: #059669;
        }
        
        .button.danger {
            background: #ef4444;
        }
        
        .button.danger:hover {
            background: #dc2626;
        }
        
        .code-block {
            background: #1f2937;
            color: #f3f4f6;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 20px 0;
            position: relative;
        }
        
        .copy-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4b5563;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .copy-button:hover {
            background: #6b7280;
        }
        
        .test-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        
        .result-box {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        
        .result-box.show {
            display: block;
        }
        
        .result-box pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .success-message {
            color: #059669;
            font-weight: 600;
            margin-top: 10px;
            display: none;
        }
        
        .success-message.show {
            display: block;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            position: relative;
            transition: color 0.3s;
        }
        
        .tab.active {
            color: #6366f1;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #6366f1;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .checklist {
            margin: 20px 0;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: #f9fafb;
            border-radius: 6px;
            transition: all 0.3s;
        }
        
        .checklist-item.completed {
            background: #d1fae5;
        }
        
        .checklist-icon {
            margin-right: 10px;
            font-size: 20px;
        }
        
        .checklist-text {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ðŸš€ DinElportal Partner Integration Test</h1>
            <p>Test your tracking integration step-by-step</p>
        </div>

        <!-- Step 1: Setup Your Partner ID -->
        <div class="card">
            <h2><span class="step-number">1</span> Setup Your Partner ID</h2>
            
            <div class="info-box">
                <h3>What is this?</h3>
                <p>Enter your unique partner ID that we provided you (e.g., 'vindstod', 'andelenergi', etc.)</p>
            </div>
            
            <div class="input-group">
                <label for="partnerId">Your Partner ID:</label>
                <input type="text" id="partnerId" placeholder="Enter your partner ID (e.g., vindstod)" value="">
            </div>
            
            <button class="button" onclick="loadTrackingScript()">Load Tracking Script</button>
            
            <div id="scriptLoadResult" class="result-box">
                <pre id="scriptLoadOutput"></pre>
            </div>
            
            <div id="integrationCode" style="display:none;">
                <h3 style="margin-top: 30px;">Your Integration Code:</h3>
                <div class="code-block">
                    <button class="copy-button" onclick="copyCode('integrationCodeText')">Copy</button>
                    <code id="integrationCodeText"></code>
                </div>
            </div>
        </div>

        <!-- Step 2: Test Script Installation -->
        <div class="card">
            <h2><span class="step-number">2</span> Test Script Installation</h2>
            
            <div class="info-box">
                <h3>What are we testing?</h3>
                <p>Checking if the tracking script loads correctly and the DinElportal API is available.</p>
            </div>
            
            <div class="status-grid">
                <div class="status-item" id="scriptStatus">
                    <div class="status-label">Script Status</div>
                    <div class="status-value">Not loaded yet</div>
                </div>
                <div class="status-item" id="apiStatus">
                    <div class="status-label">API Status</div>
                    <div class="status-value">Not available</div>
                </div>
                <div class="status-item" id="storageStatus">
                    <div class="status-label">Storage Access</div>
                    <div class="status-value">Not tested</div>
                </div>
            </div>
            
            <div class="test-actions">
                <button class="button secondary" onclick="checkInstallation()">Check Installation</button>
                <button class="button secondary" onclick="testStorage()">Test Storage</button>
            </div>
            
            <div id="installationResult" class="result-box">
                <pre id="installationOutput"></pre>
            </div>
        </div>

        <!-- Step 3: Simulate User from DinElportal -->
        <div class="card">
            <h2><span class="step-number">3</span> Simulate User Coming from DinElportal</h2>
            
            <div class="info-box">
                <h3>What happens in real life?</h3>
                <p>When users click your link on DinElportal, they arrive at your site with a click_id parameter in the URL.</p>
            </div>
            
            <div class="input-group">
                <label for="testClickId">Test Click ID (or use auto-generated):</label>
                <input type="text" id="testClickId" placeholder="dep_test_123" value="dep_test_123">
            </div>
            
            <div class="test-actions">
                <button class="button success" onclick="simulateUserArrival()">Simulate User Arrival</button>
                <button class="button" onclick="generateClickId()">Generate New Click ID</button>
            </div>
            
            <div class="status-grid" style="margin-top: 20px;">
                <div class="status-item" id="clickIdStatus">
                    <div class="status-label">Click ID Captured</div>
                    <div class="status-value">Not captured</div>
                </div>
                <div class="status-item" id="persistenceStatus">
                    <div class="status-label">Data Persisted</div>
                    <div class="status-value">Not tested</div>
                </div>
            </div>
            
            <div id="arrivalResult" class="result-box">
                <pre id="arrivalOutput"></pre>
            </div>
        </div>

        <!-- Step 4: Test Conversion Tracking -->
        <div class="card">
            <h2><span class="step-number">4</span> Test Conversion Tracking</h2>
            
            <div class="info-box">
                <h3>What are we testing?</h3>
                <p>Simulating what happens when a user completes a signup or purchase on your site.</p>
            </div>
            
            <div class="tabs">
                <button class="tab active" onclick="switchTab('auto')">Automatic Detection</button>
                <button class="tab" onclick="switchTab('manual')">Manual Tracking</button>
            </div>
            
            <div id="autoTab" class="tab-content active">
                <p style="margin-bottom: 15px;">Our script automatically detects conversions on these pages:</p>
                <ul style="margin-left: 20px; margin-bottom: 20px;">
                    <li>/tak, /bekraeftelse, /kvittering, /velkommen</li>
                    <li>/thank-you, /success, /confirmation, /complete</li>
                </ul>
                <button class="button success" onclick="simulateAutoConversion()">Simulate Auto-Detection</button>
            </div>
            
            <div id="manualTab" class="tab-content">
                <div class="input-group">
                    <label>Conversion Details:</label>
                    <input type="text" id="conversionType" placeholder="Type (e.g., signup)" value="signup" style="margin-bottom: 10px;">
                    <input type="number" id="conversionValue" placeholder="Value in DKK" value="299" style="margin-bottom: 10px;">
                    <input type="text" id="conversionProduct" placeholder="Product (e.g., premium_plan)" value="premium_plan">
                </div>
                <button class="button success" onclick="simulateManualConversion()">Track Manual Conversion</button>
            </div>
            
            <div id="conversionResult" class="result-box">
                <pre id="conversionOutput"></pre>
            </div>
            
            <div id="conversionSuccess" class="success-message">
                âœ… Conversion successfully tracked! In production, this would be sent to DinElportal.
            </div>
        </div>

        <!-- Step 5: Verification Checklist -->
        <div class="card">
            <h2><span class="step-number">5</span> Integration Checklist</h2>
            
            <div class="checklist" id="checklist">
                <div class="checklist-item" id="check1">
                    <span class="checklist-icon">â­•</span>
                    <span class="checklist-text">Tracking script loaded successfully</span>
                </div>
                <div class="checklist-item" id="check2">
                    <span class="checklist-icon">â­•</span>
                    <span class="checklist-text">DinElportal API is available</span>
                </div>
                <div class="checklist-item" id="check3">
                    <span class="checklist-icon">â­•</span>
                    <span class="checklist-text">Click ID can be captured from URL</span>
                </div>
                <div class="checklist-item" id="check4">
                    <span class="checklist-icon">â­•</span>
                    <span class="checklist-text">Data persists in storage</span>
                </div>
                <div class="checklist-item" id="check5">
                    <span class="checklist-icon">â­•</span>
                    <span class="checklist-text">Conversions can be tracked</span>
                </div>
            </div>
            
            <div class="test-actions">
                <button class="button" onclick="runFullTest()">Run Complete Test</button>
                <button class="button danger" onclick="resetEverything()">Reset Everything</button>
            </div>
            
            <div id="fullTestResult" class="result-box">
                <pre id="fullTestOutput"></pre>
            </div>
        </div>

        <!-- Help Section -->
        <div class="card">
            <h2>Need Help?</h2>
            
            <div class="warning-box">
                <p><strong>Common Issues:</strong></p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>Script blocked by ad blocker - Try disabling it for testing</li>
                    <li>Cookies disabled - Enable cookies in your browser</li>
                    <li>CORS errors - Make sure you're testing on a real domain or localhost</li>
                </ul>
            </div>
            
            <p style="margin-top: 20px;">
                <strong>Technical Support:</strong> tech@dinelportal.dk<br>
                <strong>Documentation:</strong> See PARTNER-INTEGRATION-MASTER-GUIDE.md<br>
                <strong>Response Time:</strong> Within 24 hours on business days
            </p>
        </div>
    </div>
    
    <script>
        // Global variables
        let partnerId = '';
        let scriptLoaded = false;
        let testResults = {
            scriptLoaded: false,
            apiAvailable: false,
            clickIdCaptured: false,
            dataPersisted: false,
            conversionTracked: false
        };

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', function() {
            // Check if partner_id is in URL
            const urlParams = new URLSearchParams(window.location.search);
            const urlPartnerId = urlParams.get('partner_id');
            if (urlPartnerId) {
                document.getElementById('partnerId').value = urlPartnerId;
                setTimeout(() => loadTrackingScript(), 500);
            }
            
            // Check if there's already a click_id in URL
            const clickId = urlParams.get('click_id');
            if (clickId) {
                document.getElementById('testClickId').value = clickId;
                setTimeout(() => checkClickIdCapture(), 1000);
            }
        });

        // Load tracking script with partner ID
        function loadTrackingScript() {
            partnerId = document.getElementById('partnerId').value.trim();
            
            if (!partnerId) {
                alert('Please enter your partner ID first');
                return;
            }
            
            // Remove any existing script
            const existingScript = document.querySelector('script[data-dinelportal]');
            if (existingScript) {
                existingScript.remove();
            }
            
            // Add new script
            const script = document.createElement('script');
            script.src = `https://www.dinelportal.dk/api/tracking/universal.js?partner_id=${partnerId}&debug=true`;
            script.async = true;
            script.setAttribute('data-dinelportal', 'true');
            
            script.onload = function() {
                scriptLoaded = true;
                showResult('scriptLoadResult', `âœ… Script loaded successfully for partner: ${partnerId}`);
                
                // Show integration code
                document.getElementById('integrationCode').style.display = 'block';
                document.getElementById('integrationCodeText').textContent = 
                    `<script src="https://www.dinelportal.dk/api/tracking/universal.js?partner_id=${partnerId}" async></script>`;
                
                // Update checklist
                updateChecklist(1, true);
                
                // Auto-check installation after a moment
                setTimeout(() => checkInstallation(), 500);
            };
            
            script.onerror = function() {
                showResult('scriptLoadResult', 'âŒ Failed to load script. Check your partner ID and network connection.');
            };
            
            document.head.appendChild(script);
        }

        // Check installation status
        function checkInstallation() {
            const results = [];
            
            // Check script
            const scriptEl = document.querySelector('script[data-dinelportal]');
            if (scriptEl) {
                updateStatus('scriptStatus', 'success', 'Loaded');
                results.push('âœ… Script tag found and loaded');
                testResults.scriptLoaded = true;
            } else {
                updateStatus('scriptStatus', 'error', 'Not found');
                results.push('âŒ Script tag not found');
            }
            
            // Check API
            if (typeof window.DinElportal !== 'undefined') {
                const version = window.DinElportal.version || '1.0.0';
                updateStatus('apiStatus', 'success', `v${version}`);
                results.push(`âœ… DinElportal API available (version ${version})`);
                results.push('Available methods: ' + Object.keys(window.DinElportal).join(', '));
                testResults.apiAvailable = true;
                updateChecklist(2, true);
            } else {
                updateStatus('apiStatus', 'error', 'Not available');
                results.push('âŒ DinElportal API not found');
            }
            
            showResult('installationResult', results.join('\n'));
        }

        // Test storage capabilities
        function testStorage() {
            if (!window.DinElportal) {
                showResult('installationResult', 'âŒ Please load the tracking script first');
                return;
            }
            
            const results = [];
            
            // Test localStorage
            try {
                localStorage.setItem('dinelportal_test', 'test');
                localStorage.removeItem('dinelportal_test');
                results.push('âœ… localStorage: Available');
            } catch(e) {
                results.push('âŒ localStorage: Blocked');
            }
            
            // Test sessionStorage
            try {
                sessionStorage.setItem('dinelportal_test', 'test');
                sessionStorage.removeItem('dinelportal_test');
                results.push('âœ… sessionStorage: Available');
            } catch(e) {
                results.push('âŒ sessionStorage: Blocked');
            }
            
            // Test cookies
            try {
                document.cookie = 'dinelportal_test=test; path=/';
                const hasCookie = document.cookie.includes('dinelportal_test');
                if (hasCookie) {
                    results.push('âœ… Cookies: Available');
                    document.cookie = 'dinelportal_test=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                } else {
                    results.push('âš ï¸ Cookies: Limited (may be blocked)');
                }
            } catch(e) {
                results.push('âŒ Cookies: Blocked');
            }
            
            updateStatus('storageStatus', 'success', 'Tested');
            showResult('installationResult', results.join('\n'));
        }

        // Simulate user arrival from DinElportal
        function simulateUserArrival() {
            const clickId = document.getElementById('testClickId').value || 'dep_test_' + Date.now();
            
            if (!window.DinElportal) {
                showResult('arrivalResult', 'âŒ Please load the tracking script first');
                return;
            }
            
            const results = [];
            results.push(`Simulating user arrival with click_id: ${clickId}`);
            results.push('---');
            
            // Update URL to include click_id
            const url = new URL(window.location);
            url.searchParams.set('click_id', clickId);
            window.history.pushState({}, '', url);
            results.push(`âœ… Updated URL with click_id parameter`);
            
            // Force the script to capture it
            if (window.DinElportal.captureClickId) {
                window.DinElportal.captureClickId();
            }
            
            // Check if it was captured
            setTimeout(() => {
                const data = window.DinElportal.getTrackingData();
                if (data && data.click_id) {
                    updateStatus('clickIdStatus', 'success', data.click_id);
                    results.push(`âœ… Click ID captured: ${data.click_id}`);
                    testResults.clickIdCaptured = true;
                    updateChecklist(3, true);
                    
                    // Test persistence
                    results.push('\nTesting data persistence:');
                    if (localStorage.getItem('dinelportal_click_id')) {
                        results.push('âœ… Stored in localStorage');
                    }
                    if (sessionStorage.getItem('dinelportal_click_id')) {
                        results.push('âœ… Stored in sessionStorage');
                    }
                    if (document.cookie.includes('dinelportal_click_id')) {
                        results.push('âœ… Stored in cookies');
                    }
                    
                    updateStatus('persistenceStatus', 'success', 'Data saved');
                    testResults.dataPersisted = true;
                    updateChecklist(4, true);
                    
                    results.push('\nComplete tracking data:');
                    results.push(JSON.stringify(data, null, 2));
                } else {
                    updateStatus('clickIdStatus', 'error', 'Not captured');
                    results.push('âŒ Click ID was not captured');
                }
                
                showResult('arrivalResult', results.join('\n'));
            }, 500);
        }

        // Generate new click ID
        function generateClickId() {
            const newId = 'dep_' + Date.now().toString(36) + '_' + Math.random().toString(36).substr(2, 9);
            document.getElementById('testClickId').value = newId;
        }

        // Check if click ID is captured
        function checkClickIdCapture() {
            if (window.DinElportal && window.DinElportal.getTrackingData) {
                const data = window.DinElportal.getTrackingData();
                if (data && data.click_id) {
                    updateStatus('clickIdStatus', 'success', data.click_id);
                    testResults.clickIdCaptured = true;
                    updateChecklist(3, true);
                }
            }
        }

        // Simulate automatic conversion
        function simulateAutoConversion() {
            if (!window.DinElportal) {
                showResult('conversionResult', 'âŒ Please load the tracking script first');
                return;
            }
            
            const results = [];
            results.push('Simulating automatic conversion detection...');
            results.push('---');
            
            // Change URL to success page
            const url = new URL(window.location);
            url.pathname = '/thank-you';
            results.push(`Simulating navigation to: ${url.pathname}`);
            
            // Trigger conversion
            if (window.DinElportal.trackConversion) {
                const conversionResult = window.DinElportal.trackConversion({
                    conversion_type: 'auto_detected',
                    page: '/thank-you'
                });
                
                results.push('âœ… Conversion tracking triggered');
                results.push('\nConversion data sent:');
                results.push(JSON.stringify({
                    conversion_type: 'auto_detected',
                    page: '/thank-you',
                    timestamp: new Date().toISOString()
                }, null, 2));
                
                document.getElementById('conversionSuccess').classList.add('show');
                testResults.conversionTracked = true;
                updateChecklist(5, true);
            }
            
            showResult('conversionResult', results.join('\n'));
        }

        // Simulate manual conversion
        function simulateManualConversion() {
            if (!window.DinElportal) {
                showResult('conversionResult', 'âŒ Please load the tracking script first');
                return;
            }
            
            const type = document.getElementById('conversionType').value || 'signup';
            const value = parseInt(document.getElementById('conversionValue').value) || 0;
            const product = document.getElementById('conversionProduct').value || 'unknown';
            
            const results = [];
            results.push('Tracking manual conversion...');
            results.push('---');
            
            const conversionData = {
                conversion_type: type,
                conversion_value: value,
                product: product,
                timestamp: new Date().toISOString()
            };
            
            if (window.DinElportal.trackConversion) {
                window.DinElportal.trackConversion(conversionData);
                
                results.push('âœ… Conversion tracked successfully');
                results.push('\nConversion data:');
                results.push(JSON.stringify(conversionData, null, 2));
                
                // Get current tracking data
                const trackingData = window.DinElportal.getTrackingData();
                if (trackingData && trackingData.click_id) {
                    results.push('\nAssociated with click_id: ' + trackingData.click_id);
                }
                
                document.getElementById('conversionSuccess').classList.add('show');
                testResults.conversionTracked = true;
                updateChecklist(5, true);
            }
            
            showResult('conversionResult', results.join('\n'));
        }

        // Run complete test
        function runFullTest() {
            const results = [];
            results.push('Running complete integration test...');
            results.push('=' .repeat(40));
            
            // Check each component
            results.push('\n1. SCRIPT LOADING:');
            if (testResults.scriptLoaded) {
                results.push('âœ… Script loaded successfully');
            } else {
                results.push('âŒ Script not loaded - Load the tracking script first');
            }
            
            results.push('\n2. API AVAILABILITY:');
            if (testResults.apiAvailable) {
                results.push('âœ… DinElportal API is available');
            } else {
                results.push('âŒ API not available - Check script loading');
            }
            
            results.push('\n3. CLICK ID CAPTURE:');
            if (testResults.clickIdCaptured) {
                results.push('âœ… Click ID can be captured from URL');
            } else {
                results.push('âš ï¸ Click ID not captured - Run "Simulate User Arrival"');
            }
            
            results.push('\n4. DATA PERSISTENCE:');
            if (testResults.dataPersisted) {
                results.push('âœ… Data persists in browser storage');
            } else {
                results.push('âš ï¸ Data persistence not tested');
            }
            
            results.push('\n5. CONVERSION TRACKING:');
            if (testResults.conversionTracked) {
                results.push('âœ… Conversions can be tracked');
            } else {
                results.push('âš ï¸ Conversion not tested - Test conversion tracking');
            }
            
            results.push('\n' + '=' .repeat(40));
            
            const allPassed = Object.values(testResults).every(v => v === true);
            if (allPassed) {
                results.push('\nðŸŽ‰ ALL TESTS PASSED! Your integration is ready.');
            } else {
                results.push('\nâš ï¸ Some tests not completed. Complete all steps above.');
            }
            
            showResult('fullTestResult', results.join('\n'));
        }

        // Reset everything
        function resetEverything() {
            if (confirm('This will clear all test data and reload the page. Continue?')) {
                // Clear storage
                if (window.DinElportal && window.DinElportal.clearData) {
                    window.DinElportal.clearData();
                }
                
                // Clear URL parameters
                window.history.pushState({}, '', window.location.pathname);
                
                // Reload page
                window.location.reload();
            }
        }

        // Switch tabs
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        // Helper functions
        function updateStatus(elementId, status, value) {
            const element = document.getElementById(elementId);
            element.className = 'status-item ' + status;
            element.querySelector('.status-value').textContent = value;
        }

        function showResult(elementId, content) {
            const element = document.getElementById(elementId);
            element.classList.add('show');
            element.querySelector('pre').textContent = content;
        }

        function updateChecklist(item, completed) {
            const element = document.getElementById('check' + item);
            if (completed) {
                element.classList.add('completed');
                element.querySelector('.checklist-icon').textContent = 'âœ…';
            }
        }

        function copyCode(elementId) {
            const code = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(code).then(() => {
                event.target.textContent = 'Copied!';
                setTimeout(() => {
                    event.target.textContent = 'Copy';
                }, 2000);
            });
        }
    </script>
</body>
</html>