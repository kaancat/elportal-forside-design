<!-- TESTING ONLY: Internal QA page for tracking tests. Do not link publicly. -->
<!-- Canonical tracking endpoint: /api/tracking/universal.js and /api/tracking/log -->
<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MondayBrew - Test Tracking</title>
    
    <!-- DinElportal Tracking Script with Debug Mode -->
    <script src="https://www.dinelportal.dk/universal-static.js" async></script>
    <script>
    window.DinElportalConfig = {
      "partner_id": "test-partner",
      "clickIdParam": "click_id",
      "enableAutoConversion": true,
      "conversionPatterns": ["/tak"],
      "debug": true
    };
    </script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .info-box {
            background: #e8f4fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
        }
        
        .debug-output {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        
        button:hover {
            background: #1976D2;
        }
        
        .navigation {
            margin: 20px 0;
        }
        
        .navigation a {
            display: inline-block;
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            margin: 5px;
        }
        
        .navigation a:hover {
            background: #45a049;
        }
        
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üç∫ MondayBrew Tracking Test</h1>
        
        <div class="info-box">
            <strong>üìä Tracking Status:</strong>
            <div id="trackingStatus">Checking...</div>
        </div>
        
        <div class="navigation">
            <h3>Test Navigation (Tracking Should Persist)</h3>
            <a href="?page=home">Home</a>
            <a href="?page=products">Products</a>
            <a href="?page=about">About</a>
            <a href="?page=contact">Contact</a>
            <a href="?click_id=dep_test_123">Simulate DinElportal Click</a>
        </div>
        
        <div>
            <h3>Tracking Controls</h3>
            <button onclick="checkTrackingData()">Check Tracking Data</button>
            <button onclick="triggerConversion()">Trigger Test Conversion</button>
            <button onclick="clearTracking()">Clear All Tracking</button>
            <button onclick="enableDebug()">Enable Debug Mode</button>
        </div>
        
        <div class="debug-output">
            <strong>Debug Console:</strong>
            <div id="debugConsole">
                Waiting for tracking events...<br>
                Open browser console (F12) for detailed logs.
            </div>
        </div>
        
        <div>
            <h3>Current Page Info</h3>
            <pre id="pageInfo"></pre>
        </div>
    </div>
    
    <script>
        // Debug console
        const debugConsole = document.getElementById('debugConsole');
        let debugLines = [];
        
        function addDebugLine(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'blue';
            const line = `<span style="color: ${color}">[${timestamp}] ${message}</span>`;
            debugLines.push(line);
            
            // Keep last 20 lines
            if (debugLines.length > 20) {
                debugLines.shift();
            }
            
            debugConsole.innerHTML = debugLines.join('<br>');
            debugConsole.scrollTop = debugConsole.scrollHeight;
        }
        
        // Check tracking status on load
        window.addEventListener('DOMContentLoaded', function() {
            // Display page info
            const pageInfo = {
                url: window.location.href,
                hostname: window.location.hostname,
                search: window.location.search,
                referrer: document.referrer || 'Direct',
                cookies: document.cookie ? 'Cookies enabled' : 'No cookies',
                localStorage: typeof(Storage) !== "undefined" ? 'Available' : 'Not available'
            };
            
            document.getElementById('pageInfo').textContent = JSON.stringify(pageInfo, null, 2);
            
            // Check if tracking loaded
            setTimeout(checkTrackingStatus, 1000);
        });
        
        function checkTrackingStatus() {
            const statusDiv = document.getElementById('trackingStatus');
            
            if (typeof window.DinElportal !== 'undefined') {
                statusDiv.innerHTML = '<div class="status success">‚úÖ DinElportal tracking loaded successfully</div>';
                addDebugLine('DinElportal API detected and ready', 'success');
                
                // Check for tracking data
                const data = window.DinElportal.getTrackingData();
                if (data) {
                    addDebugLine('Tracking data found: ' + JSON.stringify(data), 'success');
                    
                    if (data.click_id) {
                        statusDiv.innerHTML += '<div class="status success">üîó Click ID: ' + data.click_id + '</div>';
                    } else {
                        statusDiv.innerHTML += '<div class="status warning">‚ö†Ô∏è No click_id found (tracking as anonymous)</div>';
                    }
                } else {
                    addDebugLine('No tracking data found yet', 'warning');
                }
            } else {
                statusDiv.innerHTML = '<div class="status error">‚ùå DinElportal tracking not loaded</div>';
                addDebugLine('DinElportal API not found - script may still be loading', 'error');
                
                // Retry after 2 seconds
                setTimeout(checkTrackingStatus, 2000);
            }
        }
        
        function checkTrackingData() {
            if (typeof window.DinElportal === 'undefined') {
                addDebugLine('DinElportal not loaded yet', 'error');
                return;
            }
            
            const data = window.DinElportal.getTrackingData();
            if (data) {
                addDebugLine('Current tracking data:', 'info');
                addDebugLine(JSON.stringify(data, null, 2), 'success');
                
                // Also check cookies
                addDebugLine('Cookies: ' + document.cookie, 'info');
                
                // Check localStorage
                try {
                    const localData = {
                        click_id: localStorage.getItem('dinelportal_click_id'),
                        fingerprint: localStorage.getItem('dinelportal_fp'),
                        data: localStorage.getItem('dinelportal_data')
                    };
                    addDebugLine('LocalStorage: ' + JSON.stringify(localData), 'info');
                } catch (e) {
                    addDebugLine('Could not read localStorage: ' + e.message, 'error');
                }
            } else {
                addDebugLine('No tracking data available', 'warning');
            }
        }
        
        function triggerConversion() {
            if (typeof window.DinElportal === 'undefined') {
                addDebugLine('DinElportal not loaded yet', 'error');
                return;
            }
            
            addDebugLine('Triggering test conversion...', 'info');
            
            window.DinElportal.trackConversion({
                conversion_type: 'test',
                conversion_value: 99.99,
                conversion_currency: 'DKK',
                metadata: {
                    product: 'Monday Special Beer',
                    quantity: 6
                }
            }).then(function(result) {
                if (result) {
                    addDebugLine('‚úÖ Conversion tracked successfully!', 'success');
                } else {
                    addDebugLine('‚ùå Conversion tracking failed', 'error');
                }
            });
        }
        
        function clearTracking() {
            if (typeof window.DinElportal === 'undefined') {
                addDebugLine('DinElportal not loaded yet', 'error');
                return;
            }
            
            window.DinElportal.clearData();
            addDebugLine('All tracking data cleared', 'warning');
            
            // Refresh status
            setTimeout(checkTrackingStatus, 500);
        }
        
        function enableDebug() {
            if (typeof window.DinElportal === 'undefined') {
                addDebugLine('DinElportal not loaded yet', 'error');
                return;
            }
            
            window.DinElportal.debug(true);
            addDebugLine('Debug mode enabled - check browser console', 'success');
        }
        
        // Override console.log to capture debug messages
        const originalLog = console.log;
        console.log = function() {
            const args = Array.prototype.slice.call(arguments);
            const message = args.join(' ');
            
            // Only capture DinElportal messages
            if (message.includes('DinElportal')) {
                addDebugLine(message, 'info');
            }
            
            // Call original console.log
            originalLog.apply(console, arguments);
        };
    </script>
</body>
</html>
