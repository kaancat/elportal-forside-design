import { createClient } from '@sanity/client'
import * as dotenv from 'dotenv'

dotenv.config()

const client = createClient({
  projectId: 'yxesi03x',
  dataset: 'production',
  useCdn: false,
  apiVersion: '2025-01-01',
  token: process.env.SANITY_API_TOKEN
})

async function deployEnhancements() {
  console.log('üöÄ Deploying prognoser page enhancements...\n')
  
  try {
    // Fetch current page
    const currentPage = await client.fetch(`*[_id == "qgCxJyBbKpvhb2oGYkdQx3"][0]`)
    
    if (!currentPage) {
      console.error('‚ùå Prognoser page not found!')
      return
    }
    
    // New content sections to add
    const renewableIntro = {
      _type: 'pageSection',
      _key: 'renewable-energy-intro',
      title: 'Forst√• Gr√∏n Energi Prognoser',
      headerAlignment: 'left',
      content: [
        {
          _type: 'block',
          _key: 'intro-1',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'N√•r vinden bl√¶ser kraftigt, og solen skinner, falder elpriserne ofte markant. Det skyldes, at vindm√∏ller og solceller producerer el uden br√¶ndstofomkostninger. Jo mere gr√∏n energi i elnettet, desto lavere bliver prisen typisk.',
              _key: 'span1'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'intro-2',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'Vores 7-dages prognose viser dig, hvorn√•r Danmark forventes at have h√∏j produktion af vedvarende energi. Denne viden kan hj√¶lpe dig med at planl√¶gge dit elforbrug smartere og spare penge p√• elregningen.',
              _key: 'span2'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'section-1',
          style: 'h3',
          children: [
            {
              _type: 'span',
              text: 'S√•dan Bruger Du Prognosen',
              _key: 'span3'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'usage-1',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'Se efter perioder med h√∏j vindproduktion (over 60%) eller solproduktion i dagtimerne. Dette er de bedste tidspunkter at oplade din elbil, k√∏re vaskemaskine og opvaskemaskine, varme vand op i varmtvandsbeholderen, og lade batterier og enheder op.',
              _key: 'span4'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'section-2',
          style: 'h3',
          children: [
            {
              _type: 'span',
              text: 'Gr√∏n Energi = Lavere Priser',
              _key: 'span5'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'price-1',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'N√•r vindm√∏llerne k√∏rer for fuld kraft, kan elprisen falde til f√• √∏re per kWh - eller endda blive negativ. Det betyder, at du reelt kan blive betalt for at bruge str√∏m! Dette sker typisk p√• vindrige n√¶tter med lavt forbrug.',
              _key: 'span6'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'price-2',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'Omvendt stiger priserne ofte, n√•r det er vindstille, og solen ikke skinner. Derfor kan du spare betydelige bel√∏b ved at flytte dit forbrug til de gr√∏nne timer.',
              _key: 'span7'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'tip-1',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'üí° ',
              marks: ['strong'],
              _key: 'span8'
            },
            {
              _type: 'span',
              text: 'Praktisk tip:',
              marks: ['strong'],
              _key: 'span9'
            },
            {
              _type: 'span',
              text: ' Brug prognosen sammen med vores prisvisning til at identificere de billigste timer i den kommende uge. Ved at v√¶lge et elselskab med timeafregning kan du maksimere din besparelse.',
              _key: 'span10'
            }
          ]
        }
      ]
    }

    const productionIntro = {
      _type: 'pageSection',
      _key: 'historical-production-intro',
      title: 'S√•dan p√•virker √•rstiderne din elpris',
      headerAlignment: 'center',
      content: [
        {
          _type: 'block',
          _key: 'intro-paragraph-1',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'Har du nogensinde undret dig over, hvorfor din elregning svinger i l√∏bet af √•ret? Svaret ligger i Danmarks unikke energimix og det vejr, der former vores hverdag. At forst√• de historiske m√∏nstre i elproduktionen er den bedste m√•de at forudsige fremtidige priser og finde de billigste timer at bruge str√∏m p√•.',
              _key: 'span1'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'intro-paragraph-2',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'Prisen p√• str√∏m styres af udbud og eftersp√∏rgsel. N√•r der er masser af billig, gr√∏n str√∏m til r√•dighed, falder prisen. N√•r produktionen er lav, og vi skal bruge dyrere energikilder, stiger den. I Danmark spiller vindm√∏ller og solceller hovedrollerne i dette samspil.',
              _key: 'span2'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'seasons-heading',
          style: 'h3',
          children: [
            {
              _type: 'span',
              text: '√Örstidernes dans med energikilderne',
              _key: 'span3'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'autumn-winter',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'Efter√•r og Vinter:',
              marks: ['strong'],
              _key: 'span4'
            },
            {
              _type: 'span',
              text: ' Disse m√•neder er typisk bl√¶sende. Vores mange vindm√∏ller k√∏rer p√• fuld kapacitet og producerer enorme m√¶ngder billig str√∏m. Selvom vores forbrug til varme og lys er h√∏jt, betyder den massive vindproduktion ofte, at priserne er lavere, is√¶r om natten.',
              _key: 'span5'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'spring-summer',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'For√•r og Sommer:',
              marks: ['strong'],
              _key: 'span6'
            },
            {
              _type: 'span',
              text: ' Her tager solen over. P√• lange, solrige dage producerer solcellerne store m√¶ngder str√∏m midt p√• dagen. Samtidig er vores samlede energiforbrug lavere. Denne kombination kan f√∏re til ekstremt lave priser.',
              _key: 'span7'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'savings-paragraph',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'Ved at kende disse s√¶sonm√∏nstre kan du bedre forudsige, hvorn√•r str√∏mmen sandsynligvis vil v√¶re billigst. I grafen nedenfor kan du selv g√• p√• opdagelse i de historiske data.',
              _key: 'span8'
            }
          ]
        }
      ]
    }

    const co2Intro = {
      _type: 'pageSection',
      _key: 'co2-explanation-section',
      title: 'Forst√• sammenh√¶ngen mellem CO2 og elpriser',
      headerAlignment: 'left',
      content: [
        {
          _type: 'block',
          _key: 'block1',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'Danmarks elproduktion og CO2-udledning h√¶nger t√¶t sammen med elpriserne. N√•r vindm√∏ller og solceller producerer meget str√∏m, falder b√•de CO2-udledningen og elpriserne markant. Dette skaber en unik mulighed for at spare penge og samtidig reducere din klimap√•virkning.',
              _key: 'span1'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'block2',
          style: 'h3',
          children: [
            {
              _type: 'span',
              text: 'Hvorfor betyder lav CO2 ofte lave priser?',
              _key: 'span2'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'block3',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'Vedvarende energikilder som vind og sol har n√¶sten ingen driftsomkostninger. N√•r vinden bl√¶ser kraftigt eller solen skinner, produceres str√∏mmen billigt og uden CO2-udledning. Fossile kraftv√¶rker, der udleder CO2, er derimod dyrere at drive og bruges prim√¶rt, n√•r den gr√∏nne produktion ikke kan d√¶kke eftersp√∏rgslen.',
              _key: 'span3'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'block4',
          style: 'h3',
          children: [
            {
              _type: 'span',
              text: 'Gr√∏nne timer - en fordel for milj√∏ og √∏konomi',
              _key: 'span4'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'block5',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'Ved at flytte dit elforbrug til timer med lav CO2-intensitet kan du opn√• betydelige besparelser. Opvaskemaskiner, vaskemaskiner og elbiler kan nemt programmeres til at k√∏re, n√•r str√∏mmen er gr√∏nnest og billigst. En gennemsnitlig dansk husstand kan spare 15-25% p√• elregningen ved bevidst forbrugsflytning.',
              _key: 'span5'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'block6',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'Danmark har ambiti√∏se m√•l om 70% CO2-reduktion i 2030 og klimaneutralitet i 2050. Ved at bruge de gr√∏nne prognoser aktivt bliver du del af Danmarks gr√∏nne omstilling, hvor hver kilowatt-time t√¶ller i kampen mod klimaforandringer.',
              _key: 'span6'
            }
          ]
        }
      ]
    }

    // Update the education section to remove bullet points
    const updatedEducationSection = {
      _key: 'education-1',
      _type: 'pageSection',
      title: 'Hvordan Dannes Elpriser i Danmark?',
      headerAlignment: 'left',
      content: [
        {
          _type: 'block',
          _key: 'block1',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'Elpriser i Danmark fasts√¶ttes dagligt p√• ',
              _key: 'span1'
            },
            {
              _type: 'span',
              text: 'Nord Pool elb√∏rsen',
              _key: 'span2',
              marks: ['strong']
            },
            {
              _type: 'span',
              text: ', Nordeuropas st√∏rste elmarked. Hver dag kl. 13:00 offentligg√∏res n√¶ste dags spotpriser baseret p√• forventet udbud og eftersp√∏rgsel.',
              _key: 'span3'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'block2',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'Priserne p√•virkes af flere faktorer, hvor ',
              _key: 'span4'
            },
            {
              _type: 'span',
              text: 'vindproduktionen',
              _key: 'span5',
              marks: ['strong']
            },
            {
              _type: 'span',
              text: ' spiller en afg√∏rende rolle. N√•r det bl√¶ser kraftigt, falder priserne markant, og Danmark har faktisk nogle af Europas laveste elpriser takket v√¶re vores omfattende vindm√∏llekapacitet. Dette g√∏r vindkraft til en win-win situation - b√•de for klimaet og din pengepung.',
              _key: 'span6'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'block3',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'Ud over vindkraften bidrager ',
              _key: 'span7'
            },
            {
              _type: 'span',
              text: 'solenergi',
              _key: 'span8',
              marks: ['strong']
            },
            {
              _type: 'span',
              text: ' ogs√• til at holde priserne nede, s√¶rligt om sommeren hvor solcellerne producerer mest energi i middagstimerne. Denne gr√∏nne energiproduktion arbejder sammen med det traditionelle ',
              _key: 'span9'
            },
            {
              _type: 'span',
              text: 'forbrugsm√∏nster',
              _key: 'span10',
              marks: ['strong']
            },
            {
              _type: 'span',
              text: ', hvor vi typisk ser de h√∏jeste priser om morgenen og aftenen, n√•r danskerne kommer hjem fra arbejde og eftersp√∏rgslen stiger.',
              _key: 'span11'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'block4',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'Danmarks geografiske placering giver os ogs√• en unik fordel gennem vores ',
              _key: 'span12'
            },
            {
              _type: 'span',
              text: 'import- og eksportforbindelser',
              _key: 'span13',
              marks: ['strong']
            },
            {
              _type: 'span',
              text: ' til Tyskland, Norge og Sverige. Disse forbindelser fungerer som en slags prism√¶ssig buffer - n√•r vi har overskud af billig vindenergi, kan vi eksportere den, og n√•r vinden ligger stille, kan vi importere fra vores nabolande.',
              _key: 'span14'
            }
          ]
        },
        {
          _type: 'block',
          _key: 'block5',
          style: 'normal',
          children: [
            {
              _type: 'span',
              text: 'Vores elpris prognose analyserer alle disse faktorer for at give dig det bedste overblik over kommende priser, s√• du kan planl√¶gge dit forbrug og spare penge p√• elregningen.',
              _key: 'span15'
            }
          ]
        }
      ]
    }

    // Build new content blocks array with enhancements
    const enhancedBlocks = []
    
    currentPage.contentBlocks.forEach((block, index) => {
      // Replace education section
      if (block._key === 'education-1') {
        enhancedBlocks.push(updatedEducationSection)
      }
      // Add intro before renewable energy forecast
      else if (block._type === 'renewableEnergyForecast') {
        enhancedBlocks.push(renewableIntro)
        enhancedBlocks.push(block)
      }
      // Add intro before monthly production
      else if (block._type === 'monthlyProductionChart') {
        enhancedBlocks.push(productionIntro)
        enhancedBlocks.push(block)
      }
      // Add intro before CO2 chart
      else if (block._type === 'co2EmissionsChart') {
        enhancedBlocks.push(co2Intro)
        enhancedBlocks.push(block)
      }
      // Update regional comparison alignment
      else if (block._type === 'regionalComparison') {
        enhancedBlocks.push({
          ...block,
          headerAlignment: 'center',
          leadingText: [
            {
              _type: 'block',
              _key: 'regional-lead',
              style: 'normal',
              children: [
                {
                  _type: 'span',
                  text: 'Danmark er opdelt i to elprisomr√•der baseret p√• transmissionsnettet. DK1 omfatter Jylland og Fyn, mens DK2 d√¶kker Sj√¶lland og Bornholm. Prisforskellene opst√•r p√• grund af forskellige produktionsforhold og internationale forbindelser. Generelt har DK1 lavere priser takket v√¶re st√∏rre vindm√∏llekapacitet.',
                  _key: 'regional-span'
                }
              ]
            }
          ]
        })
      }
      // Keep other blocks as is
      else {
        enhancedBlocks.push(block)
      }
    })

    // Update the page
    console.log('üìù Updating page with enhanced content...')
    const result = await client
      .patch(currentPage._id)
      .set({ contentBlocks: enhancedBlocks })
      .commit()

    console.log('‚úÖ Page enhanced successfully!')
    console.log(`üìã Total content blocks: ${enhancedBlocks.length}`)
    console.log('üîó View at: https://elportal-forside-design.vercel.app/prognoser')
    
  } catch (error) {
    console.error('‚ùå Error:', error)
  }
}

// Run deployment
deployEnhancements()
  .then(() => {
    console.log('\nüéâ All enhancements deployed!')
    process.exit(0)
  })
  .catch((error) => {
    console.error('üí• Fatal error:', error)
    process.exit(1)
  })